[
  {
    "declare_macro": "_delete_muzzle_flash_closeup_nodes",
    "content": [
      {
        "call": "try_delete_node",
        "literals": {
          "name": "muzzle_flash_closeup_node_$MUZZLE_FLASH_SUFFIX"
        }
      }
    ]
  },
  {
    "declare_macro": "_add_muzzle_flash_closeup_scheduler_on_hide",
    "content": {
      "call": "execute_in_physics_thread",
      "literals": {
        "command": {
          "playback": "_add_muzzle_flash_closeup",
          "literals": {
            "POSITION": "%POSITION",
            "RESOURCE": "%RESOURCE",
            "ANIMATION_TIME": "%ANIMATION_TIME",
            "MUZZLE_FLASH_SUFFIX": "%MUZZLE_FLASH_SUFFIX"
          }
        },
        "capture": {
          "POSITION": "%POSITION",
          "RESOURCE": "%RESOURCE",
          "ANIMATION_TIME": "%ANIMATION_TIME",
          "MUZZLE_FLASH_SUFFIX": "%MUZZLE_FLASH_SUFFIX"
        }
      }
    }
  },
  {
    "declare_macro": "_add_muzzle_flash_closeup_scheduler_on_destroy",
    "content": [
      {
        "call": "execute_in_physics_thread",
        "literals": {
          "command": {
            "playback": "_delete_muzzle_flash_closeup_nodes",
            "literals": {
              "MUZZLE_FLASH_SUFFIX": "%MUZZLE_FLASH_SUFFIX"
            }
          },
          "capture": {
            "MUZZLE_FLASH_SUFFIX": "%MUZZLE_FLASH_SUFFIX"
          }
        }
      }
    ]
  },
  {
    "declare_macro": "_add_muzzle_flash_closeup",
    "content": [
      {
        "call": "child_node_instance",
        "literals": {
          "type": "dynamic",
          "parent": "punch_angle_node_closeup",
          "name": "muzzle_flash_closeup_node_$MUZZLE_FLASH_SUFFIX",
          "position": "%POSITION",
          "rotation": [0, 0, 0],
          "scale": 1
        }
      },
      {
        "call": "set_animation_state",
        "literals": {
          "node": "muzzle_flash_closeup_node_$MUZZLE_FLASH_SUFFIX",
          "aperiodic_animation_begin": 0,
          "aperiodic_animation_end": "%ANIMATION_TIME",
          "aperiodic_animation_time": 0
        }
      },
      {
        "call": "renderable_instance",
        "literals": {
          "name": "closeup-inst",
          "node": "muzzle_flash_closeup_node_$MUZZLE_FLASH_SUFFIX",
          "resource": "%RESOURCE"
        }
      }
    ]
  },
  {
    "declare_macro": "_generate_muzzle_flash_hider",
    "content": {
      "call": "set_node_hider",
      "literals": {
        "node_to_hide": "muzzle_flash_node$MUZZLE_FLASH_SUFFIX",
        "camera_node": "human_head_camera_node$SUFFIX",
        "on_hide": {
          "playback": "_add_muzzle_flash_closeup_scheduler_on_hide",
          "context": "weapon_closeup",
          "literals": {
            "POSITION": "%POSITION",
            "RESOURCE": "%RESOURCE",
            "ANIMATION_TIME": "%ANIMATION_TIME",
            "MUZZLE_FLASH_SUFFIX": "%MUZZLE_FLASH_SUFFIX"
          }
        },
        "on_destroy": {
          "playback": "_add_muzzle_flash_closeup_scheduler_on_destroy",
          "context": "weapon_closeup",
          "literals": {
            "MUZZLE_FLASH_SUFFIX": "%MUZZLE_FLASH_SUFFIX"
          }
        },
        "capture": {
          "POSITION": "%POSITION",
          "RESOURCE": "%RESOURCE",
          "ANIMATION_TIME": "%ANIMATION_TIME",
          "MUZZLE_FLASH_SUFFIX": "%MUZZLE_FLASH_SUFFIX"
        }
      }
    }
  }
]
